<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 - 设计学科线上课程系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .page { display: none; }
        .page.active { display: block !important; }
        .sub-page { display: none; }
        .sub-page.active { display: block !important; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border-radius: 16px;
            color: white;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hover-scale {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.03);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        
        .action-button {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            color: white;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .nav-item {
            transition: all 0.3s ease;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .activity-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            color: white;
        }
        
        .activity-card:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .ai-recommendation-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            color: white;
        }
        
        .ai-recommendation-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- 页面标题 -->
        <div class="glass-card p-6 mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">设计学科线上课程系统</h1>
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <p class="text-blue-100">欢迎回来，{{ user.username }}！</p>
                <div class="flex items-center space-x-4">
                    <a href="{{ url_for('messages') }}" class="text-white hover:text-blue-200 transition-colors">
                        <i class="fas fa-envelope text-xl"></i>
                        {% if stats.messages > 0 %}
                            <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full ml-1">{{ stats.messages }}</span>
                        {% endif %}
                    </a>
                    <a href="{{ url_for('logout') }}" class="bg-white bg-opacity-20 border border-white border-opacity-30 text-white hover:bg-opacity-30 px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2">
                        <i class="fas fa-sign-out-alt"></i>退出登录
                    </a>
                </div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 侧边栏导航 -->
            <div class="lg:col-span-1">
                <div class="glass-card p-5 mb-6">
                    <div class="text-center mb-5">
                        <div class="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3">
                            {% if user.role == 'student' %}
                                <i class="fas fa-user-graduate text-3xl text-white"></i>
                            {% elif user.role == 'teacher' %}
                                <i class="fas fa-chalkboard-teacher text-3xl text-white"></i>
                            {% else %}
                                <i class="fas fa-robot text-3xl text-white"></i>
                            {% endif %}
                        </div>
                        <h3 class="text-xl font-bold text-white">{{ user.username }}</h3>
                        <p class="text-white text-opacity-80">
                            {% if user.role == 'student' %}学生
                            {% elif user.role == 'teacher' %}教师
                            {% else %}AI助教
                            {% endif %}
                        </p>
                        <p class="text-sm text-white text-opacity-70 mt-1">{{ user.student_id }}</p>
                    </div>
                    
                    <div class="border-t border-white border-opacity-20 pt-4">
                        <h4 class="text-sm font-semibold text-white text-opacity-70 uppercase mb-3">个人信息</h4>
                        <ul class="space-y-3">
                            <li class="flex justify-between">
                                <span class="text-white text-opacity-80">角色:</span>
                                <span class="font-medium text-white">
                                    {% if user.role == 'student' %}学生
                                    {% elif user.role == 'teacher' %}教师
                                    {% else %}AI助教
                                    {% endif %}
                                </span>
                            </li>
                            <li class="flex justify-between">
                                <span class="text-white text-opacity-80">学号/工号:</span>
                                <span class="font-medium text-white">{{ user.student_id }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- 导航菜单 -->
                <div class="glass-card p-5">
                    <h4 class="text-sm font-semibold text-white text-opacity-70 uppercase mb-3">快捷导航</h4>
                    <ul class="space-y-2">
                        {% for permission in permissions %}
                            {% if permission == '学习课程' %}
                                <li>
                                    <a href="{{ url_for('courses') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-book mr-3 text-blue-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == '提交作业' %}
                                <li>
                                    <a href="{{ url_for('assignments') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-tasks mr-3 text-orange-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == '查看成绩' %}
                                <li>
                                    <a href="{{ url_for('grades') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-chart-line mr-3 text-green-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>

                            {% elif permission == '参与讨论' and user.role == 'student' %}
                                <li>
                                    <a href="{{ url_for('discussions') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-comments mr-3 text-pink-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == '创建课程' %}
                                <li>
                                    <a href="{{ url_for('teacher_create_course') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-plus-circle mr-3 text-indigo-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == '编辑课程' %}
                                <li>
                                    <a href="{{ url_for('teacher_edit_course') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-edit mr-3 text-teal-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == '批改作业' %}
                                <li>
                                    <a href="{{ url_for('teacher_grade_assignments') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-check-square mr-3 text-orange-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == '管理学生' %}
                                <li>
                                    <a href="{{ url_for('teacher_manage_students') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-users mr-3 text-red-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == '发布成绩' %}
                                <li>
                                    <a href="{{ url_for('teacher_publish_grades') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-chart-bar mr-3 text-green-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>

                            {% elif permission == '参与讨论' and user.role == 'teacher' %}
                                <li>
                                    <a href="{{ url_for('teacher_discussions') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-comments mr-3 text-pink-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% elif permission == 'AI测验管理' %}
                                <li>
                                    <a href="{{ url_for('teacher_ai_test_management') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                        <i class="fas fa-brain mr-3 text-cyan-300"></i>
                                        {{ permission }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}
                        

                        <li>
                            <a href="{{ url_for('project_groups') }}" class="nav-item flex items-center px-3 py-2 text-white hover:bg-white hover:bg-opacity-10 rounded-lg transition-colors">
                                <i class="fas fa-users-cog mr-3 text-blue-300"></i>
                                项目组管理
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 主内容区域 -->
            <div class="lg:col-span-2">
                <!-- 统计卡片 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card p-6 rounded-xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-book text-white"></i>
                            </div>
                        </div>
                        <h3 class="text-2xl font-bold text-white">{{ stats.courses }}</h3>
                        <p class="text-white text-opacity-80">
                            {% if user.role == 'student' %}已选课程
                            {% else %}教授课程
                            {% endif %}
                        </p>
                    </div>

                    <div class="stat-card p-6 rounded-xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-white"></i>
                            </div>
                            {% if user.role == 'student' %}
                                <span class="text-sm text-red-300">{{ stats.pending_assignments }} 待提交</span>
                            {% else %}
                                <span class="text-sm text-red-300">{{ stats.pending_assignments }} 待批改</span>
                            {% endif %}
                        </div>
                        <h3 class="text-2xl font-bold text-white">{{ stats.assignments }}</h3>
                        <p class="text-white text-opacity-80">
                            {% if user.role == 'student' %}作业完成
                            {% else %}作业批改
                            {% endif %}
                        </p>
                    </div>


                </div>

                <!-- 快捷入口 -->
                <div class="glass-card p-6 mb-8">
                    <h2 class="text-xl font-bold text-white mb-4">快捷入口</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        {% if '学习课程' in permissions %}
                            <a href="{{ url_for('courses') }}" class="action-button p-4 border border-white border-opacity-20 rounded-lg hover:border-blue-300 hover:bg-blue-300 hover:bg-opacity-20 transition-all text-center">
                                <i class="fas fa-book text-2xl mb-2 text-white"></i>
                                <div class="text-sm text-white">我的课程</div>
                            </a>
                        {% endif %}
                        {% if '提交作业' in permissions or '批改作业' in permissions %}
                            <a href="{{ url_for('assignments') }}" class="action-button p-4 border border-white border-opacity-20 rounded-lg hover:border-orange-300 hover:bg-orange-300 hover:bg-opacity-20 transition-all text-center">
                                <i class="fas fa-tasks text-2xl mb-2 text-white"></i>
                                <div class="text-sm text-white">作业</div>
                            </a>
                        {% endif %}

                        {% if '查看成绩' in permissions or '发布成绩' in permissions %}
                            <a href="{{ url_for('grades') }}" class="action-button p-4 border border-white border-opacity-20 rounded-lg hover:border-green-300 hover:bg-green-300 hover:bg-opacity-20 transition-all text-center">
                                <i class="fas fa-chart-line text-2xl mb-2 text-white"></i>
                                <div class="text-sm text-white">成绩</div>
                            </a>
                        {% endif %}
                        {% if '参与讨论' in permissions %}
                            {% if user.role == 'student' %}
                                <a href="{{ url_for('discussions') }}" class="action-button p-4 border border-white border-opacity-20 rounded-lg hover:border-pink-300 hover:bg-pink-300 hover:bg-opacity-20 transition-all text-center">
                                    <i class="fas fa-comments text-2xl mb-2 text-white"></i>
                                    <div class="text-sm text-white">讨论区</div>
                                </a>
                            {% else %}
                                <a href="{{ url_for('teacher_discussions') }}" class="action-button p-4 border border-white border-opacity-20 rounded-lg hover:border-pink-300 hover:bg-pink-300 hover:bg-opacity-20 transition-all text-center">
                                    <i class="fas fa-comments text-2xl mb-2 text-white"></i>
                                    <div class="text-sm text-white">讨论区</div>
                                </a>
                            {% endif %}
                        {% endif %}

                    </div>
                </div>

                <!-- 最近活动 -->
                <div class="glass-card p-6 mb-8">
                    <h2 class="text-xl font-bold text-white mb-4">最近活动</h2>
                    <div class="space-y-4">
                        {% if user.role == 'student' %}
                            {% for course in user.enrolled_courses[:3] %}
                                <div class="activity-card flex items-start space-x-4 p-3 border-b border-white border-opacity-20">
                                    <img src="https://via.placeholder.com/40x40" alt="课程封面" class="w-10 h-10 rounded-full object-cover">
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center">
                                            <h4 class="font-medium text-white">{{ course.course.title }}</h4>
                                            <span class="text-xs text-white text-opacity-70">今天</span>
                                        </div>
                                        <p class="text-sm text-white text-opacity-80">继续学习：{{ course.course.description[:50] }}...</p>
                                        <div class="mt-2">
                                            <div class="flex justify-between text-xs text-white text-opacity-70 mb-1">
                                                <span>学习进度</span>
                                                <span>{{ course.progress }}%</span>
                                            </div>
                                            <div class="w-full bg-white bg-opacity-20 rounded-full h-1.5">
                                                <div class="bg-blue-300 h-1.5 rounded-full" style="width: {{ course.progress }}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            {% for course in user.courses_taught[:3] %}
                                <div class="activity-card flex items-start space-x-4 p-3 border-b border-white border-opacity-20">
                                    <img src="https://via.placeholder.com/40x40" alt="课程封面" class="w-10 h-10 rounded-full object-cover">
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center">
                                            <h4 class="font-medium text-white">{{ course.title }}</h4>
                                            <span class="text-xs text-white text-opacity-70">今天</span>
                                        </div>
                                        <p class="text-sm text-white text-opacity-80">学生人数：{{ course.enrollments|length }}</p>
                                        <div class="mt-2 flex space-x-2">
                                            <a href="{{ url_for('teacher_edit_course', course_id=course.id) }}" class="text-xs bg-blue-300 bg-opacity-30 text-white px-2 py-1 rounded">编辑课程</a>
                                            <a href="{{ url_for('teacher_grade_assignments', course_id=course.id) }}" class="text-xs bg-orange-300 bg-opacity-30 text-white px-2 py-1 rounded">批改作业</a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="text-center mt-4">
                        <a href="#" class="text-blue-300 hover:text-blue-200 transition-colors">查看全部活动</a>
                    </div>
                </div>

                <!-- AI推荐 -->
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-magic mr-2 text-purple-300"></i>AI 推荐
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="ai-recommendation-card p-4 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <img src="https://via.placeholder.com/80x60" alt="课程" class="w-20 h-15 object-cover rounded">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-white">高级版式设计技巧</h3>
                                    <p class="text-sm text-white text-opacity-80 mb-2">基于你的学习进度推荐</p>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs bg-blue-300 bg-opacity-30 text-white px-2 py-1 rounded">匹配度 95%</span>
                                        <a href="#" class="text-blue-300 hover:text-blue-200 text-sm">查看详情 →</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ai-recommendation-card p-4 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <img src="https://via.placeholder.com/80x60" alt="案例" class="w-20 h-15 object-cover rounded">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-white">品牌设计案例分析</h3>
                                    <p class="text-sm text-white text-opacity-80 mb-2">行业实战案例精选</p>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs bg-green-300 bg-opacity-30 text-white px-2 py-1 rounded">热门推荐</span>
                                        <a href="#" class="text-blue-300 hover:text-blue-200 text-sm">查看案例 →</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showPage(pageId) {
            // 隐藏所有页面
            document.querySelectorAll('.page, .sub-page').forEach(page => {
                page.classList.remove('active');
            });
            // 显示目标页面
            document.getElementById(pageId).classList.add('active');
        }

        function showSubPage(subPageId, parentPageId) {
            // 隐藏所有子页面
            document.querySelectorAll('.sub-page').forEach(page => {
                page.classList.remove('active');
            });
            // 显示当前页面
            document.getElementById(parentPageId).classList.add('active');
            // 显示子页面
            document.getElementById(subPageId).classList.add('active');
        }
    </script>
</body>
</html>