<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测验结果 - 设计学科线上课程系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            color: white;
        }
        .action-button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        .action-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px 0 rgba(31, 38, 135, 0.4);
        }
        .danger-button {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: white;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        .danger-button:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px 0 rgba(239, 68, 68, 0.4);
        }
        .message-info {
            background: rgba(165, 243, 252, 0.2);
            border: 1px solid rgba(165, 243, 252, 0.3);
            color: white;
            border-radius: 8px;
        }
        .student-answer {
            background: rgba(147, 197, 253, 0.2);
            border: 1px solid rgba(147, 197, 253, 0.3);
            border-radius: 8px;
            color: white;
        }
        .correct-answer {
            background: rgba(110, 231, 183, 0.2);
            border: 1px solid rgba(110, 231, 183, 0.3);
            border-radius: 8px;
            color: white;
        }
        .wrong-answer {
            background: rgba(252, 165, 165, 0.2);
            border: 1px solid rgba(252, 165, 165, 0.3);
            border-radius: 8px;
            color: white;
        }
        .score-section {
            background: rgba(254, 243, 199, 0.2);
            border: 1px solid rgba(254, 243, 199, 0.3);
            border-radius: 8px;
            font-weight: bold;
            color: white;
        }
        .primary-button {
            background: rgba(139, 92, 246, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.4);
            color: white;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        .primary-button:hover {
            background: rgba(139, 92, 246, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px 0 rgba(139, 92, 246, 0.4);
        }
        .warning-button {
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: white;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        .warning-button:hover {
            background: rgba(251, 191, 36, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px 0 rgba(251, 191, 36, 0.4);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- 页面标题 -->
        <div class="glass-card p-6 mb-8">
            <div class="flex flex-wrap justify-between items-center gap-4">
                <h1 class="text-3xl font-bold text-white">测验结果</h1>
                <div class="flex flex-wrap items-center gap-3">
                    <a href="{{ url_for('student_ai_quizzes') }}" class="action-button px-4 py-2 font-medium flex items-center">
                        <i class="fas fa-list mr-2"></i>返回测验列表
                    </a>
                    <a href="{{ url_for('dashboard') }}" class="action-button px-4 py-2 font-medium flex items-center">
                        <i class="fas fa-user-circle mr-2"></i>返回个人中心
                    </a>
                    <a href="{{ url_for('logout') }}" class="danger-button px-4 py-2 font-medium flex items-center">
                        <i class="fas fa-sign-out-alt mr-2"></i>退出登录
                    </a>
                </div>
            </div>
        </div>
        
        <!-- 消息提示区域 -->
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="message-info p-4 mb-6 rounded-lg flex justify-between items-center">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-blue-300 mr-3"></i>
                            <span>{{ message }}</span>
                        </div>
                        <button type="button" class="text-white opacity-70 hover:opacity-100">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <!-- 结果头部信息 -->
        <div class="glass-card p-8 mb-8 text-center">
            <h2 class="text-2xl font-semibold text-white mb-4">{{ quiz.title }}</h2>
            <div class="text-5xl font-bold text-green-300 mb-4">{{ student_quiz.score }} / {{ total_score }}</div>
            <div class="space-y-3">
                <div class="flex justify-center items-center gap-2">
                    <i class="fas fa-check-circle text-blue-300"></i>
                    <span class="text-white/80"><strong>状态：</strong>{{ student_quiz.status }}</span>
                </div>
                <div class="flex justify-center items-center gap-2">
                    <i class="fas fa-clock text-yellow-300"></i>
                    <span class="text-white/80"><strong>开始时间：</strong>{{ student_quiz.start_time.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                </div>
                <div class="flex justify-center items-center gap-2">
                    <i class="fas fa-flag-checkered text-purple-300"></i>
                    <span class="text-white/80"><strong>结束时间：</strong>{{ student_quiz.end_time.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                </div>
                <div class="flex justify-center items-center gap-2">
                    <i class="fas fa-stopwatch text-green-300"></i>
                    <span class="text-white/80"><strong>用时：</strong>{{ time_spent }}分钟</span>
                </div>
                {% if student_quiz.cheat_count > 0 %}
                    <div class="flex justify-center items-center gap-2 text-red-300">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span><strong>作弊警告次数：</strong>{{ student_quiz.cheat_count }}</span>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- 答题详情 -->
        <div class="glass-card p-6 mb-8">
            <h3 class="text-2xl font-semibold text-white mb-6">答题详情</h3>
            
            {% for sa in student_answers %}
                <div class="glass-card p-6 mb-6">
                    <div class="flex justify-between items-start mb-3">
                        <h5 class="text-xl font-semibold text-white">{{ loop.index }}. {{ sa.question.content }}</h5>
                        <span class="text-white/60">({{ sa.question.qtype }})</span>
                    </div>
                    
                    {% if sa.question.parsed_options %}
                        <div class="mt-4 mb-4">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-list-ul text-blue-300 mr-2"></i>
                                <span class="font-medium text-white/90"><strong>选项：</strong></span>
                            </div>
                            <ul class="list-decimal list-inside space-y-1 text-white/80 pl-4">
                                {% for key, value in sa.question.parsed_options.items() %}
                                    <li>{{ key }}. {{ value }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    
                    <div class="space-y-4 mt-4">
                        <div>
                            <div class="flex items-center mb-2">
                                <i class="fas fa-user-graduate text-yellow-300 mr-2"></i>
                                <span class="font-medium text-white/90"><strong>你的答案：</strong></span>
                            </div>
                            <div class="student-answer p-4">{{ sa.student_answer }}</div>
                        </div>
                        
                        <div>
                            <div class="flex items-center mb-2">
                                <i class="fas fa-check-circle text-green-300 mr-2"></i>
                                <span class="font-medium text-white/90"><strong>正确答案：</strong></span>
                            </div>
                            <div class="correct-answer p-4">{{ sa.question.answer }}</div>
                        </div>
                        
                        {% if sa.score == sa.question.score %}  
                            <div class="score-section p-3 text-green-300">
                                <i class="fas fa-trophy text-green-400 mr-2"></i>
                                得分：{{ sa.score }}/{{ sa.question.score }}
                            </div>
                        {% else %}
                            <div class="score-section p-3 text-red-300">
                                <i class="fas fa-times-circle text-red-400 mr-2"></i>
                                得分：{{ sa.score }}/{{ sa.question.score }}
                            </div>
                            <div class="wrong-answer p-4 mt-2">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-lightbulb text-yellow-300 mr-2"></i>
                                    <span class="font-medium text-white/90"><strong>解析：</strong></span>
                                </div>
                                {% if sa.question.score_std %}
                                    <p class="text-white/80">{{ sa.question.score_std }}</p>
                                {% else %}
                                    <p class="text-white/80">请仔细查看正确答案并理解知识点</p>
                                {% endif %}
                            </div>
                            <!-- 错题加入错题集按钮 -->
                            <form action="{{ url_for('add_to_error_bank') }}" method="post" class="mt-4">
                                <input type="hidden" name="question_id" value="{{ sa.question.qid }}">
                                <input type="hidden" name="student_id" value="{{ user.id }}">
                                <input type="hidden" name="student_quiz_id" value="{{ student_quiz_id }}">
                                <button type="submit" class="warning-button px-4 py-2 font-medium flex items-center">
                                    <i class="fas fa-bookmark mr-2"></i>加入错题集
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- 返回按钮 -->
        <div class="text-center">
            <a href="{{ url_for('student_ai_quizzes') }}" class="primary-button px-6 py-3 font-medium flex items-center mx-auto justify-center">
                <i class="fas fa-arrow-left mr-2"></i>返回测验列表
            </a>
        </div>
    </div>
</body>
</html>